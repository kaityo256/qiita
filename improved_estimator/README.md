# Improved Estimatorのわかりやすい(つもりの)説明

## はじめに

Improved Estimatorが分かりづらい。教科書にもさらっとした触れられてないし、引用文献も見当たらない。ググってもよくわからないが、知っている人は知っている。そんなImproved Estimatorについて僕でもわかるようにわかりやすく説明したつもりの記事です。いか、かなりレベルの低いところから書いているので、モンテカルロガチ勢な人はブラウザの戻るボタンを押すかタブを閉じてください。

## マルコフ連鎖モンテカルロ法

Improved Estimatorについて調べてたら、「そもそもなんでマルコフ連鎖モンテカルロ法で物理量が推定できるんだっけ？」というところからあやふやになってきたので、そこからまとめます。この記事はそんなレベルの人が書いています。

なにか系の状態が$S$で表現されているとします。スピン系の言葉で言うなら、$S$はスピンコンフィグレーションを表します。$N$個の$\pm 1$イジングスピン系なら、$S$は$N$個の-1か1の数の配列だと思えば良いです。スピンを$\sigma_i$で表します。以下、$S$があるスピン状態を表すことを

$$
S = \left\{ \sigma_i \right\}
$$

と表現しましょう。

さて、この系の状態$S$について、重み$w(S)$が指定されているとします。ただし、$w$は規格化されており、すべてのとり得る$S$について和を取ると$1$となるものとします。

$$
\sum_{\{S\}} w(S) = 1
$$

イジングモデルの言葉で言えば、ハミルトニアン

$$
H = -J \sum_{\left< i,j \right>} \sigma_i \sigma_j
$$

に対して、ボルツマン重みを規格化したものが$w$です。具体的に書くと、

$$
w(S) = \frac{\exp(-\beta H(S))}{\sum_{\{S'\}}\exp(-\beta H(S'))}
$$

です。分母はいわゆる分配関数ですね。

いま、物理量$A$が状態$S$の関数として求まるとしましょう。この時、$A$の期待値$\left< A\right>$は

$$
\left< A\right> = \sum_{\left\{S\right\}} A(S)w(S)
$$

で求めることができます。しかし、一般に$S$がとり得る状態数は膨大($N$個のイジングスピン系なら$2^N$個の状態がある)で、この和を実行することはできません。そこで、サンプリングによりこの和を評価することにします。その手法の一つがマルコフ連鎖モンテカルロ法です。

マルコフ連鎖モンテカルロ法は、時刻$t$における状態$S_t$から、なにかうまいことをやって次の状態$S_{t+1}$を作る手法です。この時、$S_t$の出現確率が$w(S_t)$に比例するように遷移確率を作ります。このあたりの話は教科書やレビュー論文に間違いなく書いてあるので詳細は省きます。

いま、初期状態$S_1$から、次々と状態を生成していって、$S_T$まで状態を作ったとしましょう。この時、物理量の時間平均$\bar{A}$は、

$$
\bar{A} = \frac{1}{T} \sum_t^T A(S_t)
$$

となります。これはただ時間平均の定義をそのまま書いただけです。さて、いま状態が$T$個ありますが、そのうち$S$という状態が$f_S$回出現したとしましょう。すると、先程の時間に関する和を、状態に関する和に書き換えることができます。

$$
\bar{A} = \frac{1}{T} \sum_{\{S\}} f_S A(S)
$$

和を時刻$t$から状態$\{S\}$で取るように変えた代わりに、物理量$A(S)$に、その出現頻度$f_S$がかかりました[^1]。

さて、マルコフ連鎖モンテカルロ法は、状態$S$を確率$w(S)$で生成する手法ですから、時系列の数$T$が大きければ$S$の出現割合は$w(S)$に近づいていくはずです。つまり、

$$
w(S) \sim \frac{f_S}{T}
$$

が成り立ちます。これを使って時間平均を書き直すと、

$$
\bar{A} \sim \sum_{\{S\}} A(S) w(S)
$$

これは$A$の期待値$\left<A\right>$にほかなりません。以上から、マルコフ連鎖モンテカルロ法で生成した時系列の時間平均$\bar{A}$が、$T$が大きい極限で$\left<A\right>$に収束していくことがわかりました。

[^1]: Density of Stateという言葉の方がなじみがあるかもしれません。